<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../css/login.css">
    <link rel="stylesheet" href="../css/styleChat.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.1/jquery.min.js"></script>
    <script src="../js/switch.js"></script>
    <title>Benvenuto</title>
</head>

<body onload="clearInputs()">
    <div class="container" id="abcd">
        <div class="form-container sign-up-container">
            <div class="form-data">
                <h1>Registrati</h1>
                <span>ed inizia a chattare con i tuoi amici</span>
                <input type="text" id="nameSignUp" placeholder="Nome" required />
                <input type="text" id="surnameSignUp" placeholder="Cognome" required />
                <input type="text" id="usernameSignUp" placeholder="Username" required />
                <div id="username-error" class="nascondi"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0,0,256,256" width="15px" height="15px" fill-rule="nonzero"><g fill="#df0000" fill-rule="nonzero" stroke="none" stroke-width="1" stroke-linecap="butt" stroke-linejoin="miter" stroke-miterlimit="10" stroke-dasharray="" stroke-dashoffset="0" font-family="none" font-weight="none" font-size="none" text-anchor="none" style="mix-blend-mode: normal"><g transform="scale(8.53333,8.53333)"><path d="M15,3c-6.627,0 -12,5.373 -12,12c0,6.627 5.373,12 12,12c6.627,0 12,-5.373 12,-12c0,-6.627 -5.373,-12 -12,-12zM16,21h-2v-7h2zM15,11.5c-0.828,0 -1.5,-0.672 -1.5,-1.5c0,-0.828 0.672,-1.5 1.5,-1.5c0.828,0 1.5,0.672 1.5,1.5c0,0.828 -0.672,1.5 -1.5,1.5z"></path></g></g></svg> &nbsp;Username gi&aacute; utilizzato</div>
                <input type="password" id="passwordSignUp" placeholder="Password" required />
                <button onclick="signUp()">Sign-Up</button>
            </div>
        </div>
        <div class="form-container sign-in-container">
            <div class="form-data">
                <h1>Login</h1>
                <span>e contiuna a chattare con i tuoi amici</span>
                <input type="text" name="name" id="usernameSignIn" placeholder="Username" required />
                <input type="password" name="password" id="passwordSignIn" placeholder="Password" required />
                <div id="user-error" class="nascondi"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0,0,256,256" width="15px" height="15px" fill-rule="nonzero"><g fill="#df0000" fill-rule="nonzero" stroke="none" stroke-width="1" stroke-linecap="butt" stroke-linejoin="miter" stroke-miterlimit="10" stroke-dasharray="" stroke-dashoffset="0" font-family="none" font-weight="none" font-size="none" text-anchor="none" style="mix-blend-mode: normal"><g transform="scale(8.53333,8.53333)"><path d="M15,3c-6.627,0 -12,5.373 -12,12c0,6.627 5.373,12 12,12c6.627,0 12,-5.373 12,-12c0,-6.627 -5.373,-12 -12,-12zM16,21h-2v-7h2zM15,11.5c-0.828,0 -1.5,-0.672 -1.5,-1.5c0,-0.828 0.672,-1.5 1.5,-1.5c0.828,0 1.5,0.672 1.5,1.5c0,0.828 -0.672,1.5 -1.5,1.5z"></path></g></g></svg> &nbsp;Nome utente o password errato</div>
                <button onclick="signIn()">Sign-In</button>
            </div>
        </div>
        <div class="overlay-container">
            <div class="overlay">
                <div class="overlay-panel overlay-left">
                    <h1>Rieccoti!</h1>
                    <p>Hai già con chi chattare?</p>
                    <button class="ghost" id="signIn">Effettua il login</button>
                </div>
                <div class="overlay-panel overlay-right">
                    <h1>Non hai un account?</h1>
                    <p>È il momento giusto per crearne uno!</p>
                    <button class="ghost" id="signUp">Registrati</button>
                </div>
            </div>
        </div>
    </div>
</body>
<script>
    function clearInputs() {
        $('#nameSignUp').val('');
        $('#surnameSignUp').val('');
        $('#usernameSignUp').val('');
        $('#passwordSignUp').val('');
        $('#usernameSignIn').val('');
        $('#passwordSignIn').val('');
    }

    function signIn() {
        let username = $("#usernameSignIn").val();
        let psw = $("#passwordSignIn").val();

        $.ajax(
            {
                url: '../php/login.php',
                data: { ':username': username, ':password': psw },
                method: 'POST',
                success: function (response) {  //3: non corrette; 4:correttamente
                    data = JSON.parse(response);
                    let id = (data['Id'] ? data['Id'] : null);
                    SignManager(data['State'], id);
                },
                error: function () {
                    console.log("Sono qui");
                }
            }
        );
    }

    function signUp() {
        let name = $("#nameSignUp").val();
        let surname = $("#surnameSignUp").val();
        let username = $("#usernameSignUp").val();
        let psw = $("#passwordSignUp").val();

        $.ajax(
            {
                url: '../php/register.php',
                data: { ':name': name, ':surname': surname, ':username': username, ':password': psw },
                method: 'POST',
                success: function (response) {      //1: duplicato; 2:registrato
                    console.log(response);
                    data = JSON.parse(response);
                    let id = (data['Id'] ? data['Id'] : null);
                    SignManager(data['State'], id);
                },
                error: function () {
                    console.log("Sono qui");
                }
            }
        );
    }

    function SignManager(state, id) {
        switch (state) {
            case 1:
                $("#username-error").removeClass("nascondi");
                $("#username-error").addClass("mostra");
                $("#usernameSignUp").css("border", "2px solid #df0000");
                $("#usernameSignUp").css("background-color", "#df000029");
                break;
            case 2:
                $("#username-error").removeClass("mostra");
                $("#username-error").addClass("nascondi");
                window.location.replace("../html/chat.html?new=true&id="+id);
                break;
            case 3:
                $("#user-error").removeClass("nascondi");
                $("#user-error").addClass("mostra");
                $("#usernameSignIn").css("border", "2px solid #df0000");
                $("#usernameSignIn").css("background-color", "#df000029");
                $("#passwordSignIn").css("border", "2px solid #df0000");
                $("#passwordSignIn").css("background-color", "#df000029");
                break;
            case 4:
                $("#user-error").removeClass("mostra");
                $("#user-error").addClass("nascondi");
                window.location.replace("../html/chat.html?new=false&id="+id);
                break;
        }
    }

</script>

</html>